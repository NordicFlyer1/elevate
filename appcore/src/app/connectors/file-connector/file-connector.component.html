<mat-card>
  <mat-card-title>
    Files <span class="mat-body-1">(Gpx, Tcx & Fit formats)</span>
  </mat-card-title>
  <mat-card-subtitle *ngIf="fileConnectorInfo">
    <span *ngIf="humanSyncDateTime">{{humanSyncDateTime}} </span>
    <span *ngIf="!fileConnectorInfo.sourceDirectory">Not configured. </span>
    <span
      *ngIf="fileConnectorInfo.sourceDirectory">Configured&nbsp;âž”&nbsp;<i>{{fileConnectorInfo.sourceDirectory | shorten: 90: '...'}}</i></span>
  </mat-card-subtitle>
  <mat-card-content>
    <div>
      <button [disabled]="appService.isSyncing"
              (click)="sync(true)" *ngIf="syncDateTime && fileConnectorInfo.sourceDirectory" color="primary"
              mat-stroked-button
              matTooltip="Activity files added or modified after date '{{syncDateTime | date:'medium'}}' will be synced">
        <mat-icon fontSet="material-icons-outlined">sync</mat-icon>
        Sync new activities
      </button>
      <button [disabled]="appService.isSyncing" (click)="sync(false)"
              *ngIf="fileConnectorInfo.sourceDirectory" color="primary"
              mat-stroked-button
              matTooltip="All activity files will be synced.">
        <mat-icon fontSet="material-icons-outlined">sync</mat-icon>
        Sync all activities
      </button>
      <button [disabled]="appService.isSyncing" (click)="showConfigure = !showConfigure"
              *ngIf="!showConfigure" color="primary" mat-stroked-button>
        <mat-icon fontSet="material-icons-outlined">build</mat-icon>
        Configure
      </button>
    </div>
    <div *ngIf="showConfigure && fileConnectorInfo" class="configureView" fxFill>
      <div>
        <mat-form-field fxFill>
          <input [(ngModel)]="fileConnectorInfo.sourceDirectory" [disabled]="true" matInput
                 placeholder="{{ (!fileConnectorInfo.sourceDirectory) ? 'Browse for a directory to scan...' : 'Scan directory' }}"
                 type="text">
          <button *ngIf="fileConnectorInfo.sourceDirectory" (click)="onUserDirectoryOpen()" color="primary" matTooltip="Locate configured directory"
                  mat-icon-button
                  matSuffix>
            <mat-icon fontSet="material-icons-outlined">gps_fixed</mat-icon>
          </button>
          <button (click)="onUserDirectorySelection()" color="primary" mat-icon-button matTooltip="Browse directory"
                  matSuffix>
            <mat-icon fontSet="material-icons-outlined">folder_open</mat-icon>
          </button>
        </mat-form-field>
      </div>

      <div *ngIf="fileConnectorInfo.sourceDirectory">
        <div>
          <mat-checkbox (change)="saveChanges()" [(ngModel)]="fileConnectorInfo.scanSubDirectories">
            Scan subdirectories
          </mat-checkbox>
        </div>
        <div fxLayout="row" fxLayoutAlign="start start">
          <mat-checkbox (change)="saveChanges()" [(ngModel)]="fileConnectorInfo.extractArchiveFiles"
                        matTooltip="Activities found in 'zip, 7z, tar, gz, bz2, zipx or xz' files will be extracted into the scan directory. Use case: Strava.com activities backup.">
            Extract activities from archives files *
          </mat-checkbox>
          <div fxFlex="3"></div>
          <mat-checkbox (change)="saveChanges()"
                        [(ngModel)]="fileConnectorInfo.deleteArchivesAfterExtract"
                        [disabled]="!fileConnectorInfo.extractArchiveFiles"
                        matTooltip="Once activities have been extracted from a 'zip, 7z, tar, gz, bz2, zipx or xz' file, the archive file will be removed from scan directory">
            Delete archives when activities have been extracted from them (recommended) *
          </mat-checkbox>
        </div>
        <div>
          <mat-checkbox (change)="saveChanges()"
                        [(ngModel)]="fileConnectorInfo.detectSportTypeWhenUnknown"
                        matTooltip="This case often occurs on GPX files. Note that this may introduce errors (e.g.: Inline skating gpx activity without sport type could be detected as 'Ride')">
            <strong>Experimental:</strong> Try to set when possible the activity type to <i>Ride or Run</i>
            if sport type is unknown <i>(adds a "#detected" in activities names)</i>
          </mat-checkbox>
        </div>
        <div>
          * Only when <u>syncing all activities</u>
        </div>
      </div>
    </div>
  </mat-card-content>
</mat-card>
